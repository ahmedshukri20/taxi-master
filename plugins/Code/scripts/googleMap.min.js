"use strict";function initializeMap(){displayInitialLocations();var e=new google.maps.LatLng(33.7294,73.0931),t={center:e,zoom:8};googleMap=new google.maps.Map(document.getElementById("googleMap"),t),google.maps.event.addListener(googleMap,"click",function(e){if(null!==lastLocationTextBox){marker&&(marker.setMap(null),marker=null);var t=new google.maps.Geocoder;t.geocode({latLng:e.latLng},function(t,a){if(a==google.maps.GeocoderStatus.OK&&t[0]){var r=t[0].formatted_address;marker=new google.maps.Marker({position:e.latLng,map:googleMap,title:r}),$("#"+lastLocationTextBox).val(r),$("#"+lastLocationTextBox).data("lat",e.latLng.lat()),$("#"+lastLocationTextBox).data("lng",e.latLng.lng()),priceCalculated=!1}})}})}function addAutoComplete(e){$("#"+e).focus(function(){lastLocationTextBox=e});var t=new google.maps.places.Autocomplete(document.getElementById(e));t.addListener("place_changed",function(){var a=t.getPlace(),r=getCountry(a);googleMap.setCenter(a.geometry.location),googleMap.setZoom(15),$("#"+e).data("lat",a.geometry.location.lat()),$("#"+e).data("lng",a.geometry.location.lng()),$("#"+e).data("country",r),priceCalculated=!1,marker&&(marker.setMap(null),marker=null),marker=new google.maps.Marker({position:a.geometry.location,map:googleMap,title:a.formatted_address})})}function getCountry(e){let t=null;for(const a of e.address_components){for(const e of a.types){switch(e){case"country":t=a.long_name}if(t)break}if(t)break}return t}function addLocationBox(e){$("#locations").append('<div class="form-group" id="'+e+'Fields"><label for="'+e+'" class="sr-only">Location</label><input id="'+e+'" type="text" placeholder="Location" class="form-control location-box" /><a href="javascript:removeLocation(\''+e+'Fields\');"><span class="glyphicon glyphicon-remove remove-icon"></span></a></div>')}function removeLocation(e){$("#"+e).remove(),priceCalculated=!1}function displayInitialLocations(){locationCounter++;var e="txtLocation"+locationCounter;addLocationBox(e),addAutoComplete(e),locationCounter++;e="txtLocation"+locationCounter;addLocationBox(e),addAutoComplete(e)}const METERS_IN_KM=1e3,SECONDS_IN_MINUTE=60,MINUTES_IN_HOUR=60;var directionsRenderer,googleMap,marker,locationCounter=0,lastLocationTextBox=null,distanceInKM=0,totalFare=0,travelPrice=0,mins=0,hrs=0,priceCalculated=!1,countryFare=null,fareList={France:{currency:"€",startingPrice:9,pricePerKm:1.5},Germany:{currency:"€",startingPrice:9,pricePerKm:1.5},Greece:{currency:"€",startingPrice:9,pricePerKm:1.5},"United Kingdom":{currency:"£",startingPrice:8,pricePerKm:1.4},Canada:{currency:"$",startingPrice:18,pricePerKm:3},"United States":{currency:"$",startingPrice:10,pricePerKm:2},Australia:{currency:"$",startingPrice:18,pricePerKm:3}};$(document).ready(function(){$("#fareDetails").hide(),$("#btnClearDirections").click(function(){confirm("Are you sure you want to clear all locations?")&&($("#fareDetails").hide(),priceCalculated=!1,distanceInKM=0,totalFare=0,travelPrice=0,mins=0,hrs=0,directionsRenderer&&directionsRenderer.setMap(null),$("#frmLocation").get(0).reset(),$("#locations").empty(),locationCounter=0,displayInitialLocations(),marker&&(marker.setMap(null),marker=null))}),$("#btnAddLocation").click(function(){locationCounter++;var e="txtLocation"+locationCounter;addLocationBox(e),addAutoComplete(e),priceCalculated=!1}),$("#btnGetJson").click(function(){if(priceCalculated){var e=[];$('#locations input[type="text"]').each(function(t,a){var r={address:$(a).val(),lat:$(a).data("lat"),lng:$(a).data("lng")};e.push(r)});var t={locations:e,distanceInKM:distanceInKM,startingPrice:countryFare.startingPrice,travelPrice:travelPrice,totalFare:totalFare,mins:mins,hrs:hrs};alert(JSON.stringify(t))}else alert("Please calculate the fare first.")}),$("#btnCalculateFare").click(function(){directionsRenderer&&directionsRenderer.setMap(null),marker&&(marker.setMap(null),marker=null),$("#fareDetails").hide();var e=new google.maps.DirectionsService;directionsRenderer=new google.maps.DirectionsRenderer({map:googleMap,draggable:!1});var t=null,a=null,r=null,o=[],n=!0,i=!1,l=0,c=null;if($('#locations input[type="text"]').each(function(e,a){if(l++,""===$(a).val().trim())return alert("Please enter location."),$(a).focus(),n=!1,!1;if(0===e)t=$(a).data("lat")+" "+$(a).data("lng");else{if(null!==r){var s={location:r,stopover:!0};o.push(s)}r=$(a).data("lat")+" "+$(a).data("lng"),$(a).data("country")!=c&&(i=!0)}c=$(a).data("country")}),a=r,n)if(0!==l)if(1!==l)if(i)alert("Sorry, we don't provide cross border services.");else if(countryFare=fareList[c],countryFare){var s={origin:t,destination:a,travelMode:google.maps.TravelMode.DRIVING,waypoints:o,optimizeWaypoints:$("#chkOptimizePath").is(":checked")};e.route(s,function(e,t){if(t==google.maps.DirectionsStatus.OK){directionsRenderer.setDirections(e);for(var a=0,r=0,o=0;o<e.routes[0].legs.length;o++){var n=e.routes[0].legs[o];a+=n.distance.value,r+=n.duration.value}distanceInKM=a/METERS_IN_KM;var i=r/SECONDS_IN_MINUTE,l=i/MINUTES_IN_HOUR;travelPrice=countryFare.pricePerKm*distanceInKM,totalFare=countryFare.startingPrice+travelPrice;var c="";mins=0,hrs=0,l<1?(mins=i.toFixed(0),c=mins+" minute"+(mins>1?"s":"")):(mins=(i%MINUTES_IN_HOUR).toFixed(0),hrs=Math.floor(l),c=hrs+" hour"+(hrs>1?"s":"")+", "+mins+" minute"+(mins>1?"s":"")),$("#distance").text(distanceInKM.toFixed(2)+" KM"),$("#duration").text(c),$("#startingPrice").text(countryFare.currency+countryFare.startingPrice.toFixed(2)),$("#travelPrice").text(countryFare.currency+travelPrice.toFixed(2)),$("#fare").text(countryFare.currency+totalFare.toFixed(2)),$("#totalFare").text(countryFare.currency+totalFare.toFixed(2)),$("#fareDetails").show(),priceCalculated=!0}else alert("We could not find any result for your search.")})}else alert("Sorry, we provide services in below countries only.\nFrance\nGermany\nGreece\nUnited Kingdom\nCanada\nUnited States\nAustralia\n");else alert("Please add destination location.");else alert("Please add source and destination locations.")})}),google.maps.event.addDomListener(window,"load",initializeMap);